# SS-MIX2を用いた診療情報データベース構築の為のSS-MIX2モジュール技術仕様書

更新日： 2019/02/05

## 1. システム要件

国立病院機構の各病院にて「国立病院機構診療情報分析基盤(NCDA)」に参加する為に調達するSS-MIX２モジュールの機能は以下の通りである。
但し、本体の電子カルテシステム等の仕様上、作成が不可能であるものについては作成を要しない。その場合、何が不可能かを導入標準作業手順書に記載すること。

### 1.1 SS-MIX2 Ver.1.2d機能

SS-MIX2 Ver.1.2dに準拠することとして、以下の機能を有すること。
 
* 日本医療情報学会発行の「SS-MIX2標準化ストレージ構成の説明と構築ガイドラインVer.1.2d」、「SS-MIX2拡張ストレージ構成の説明と構築ガイドラインVer.1.2d」、「SS-MIX2標準化ストレージ仕様書Ver.1.2d」、「標準化ストレージ仕様書別紙：コード表Ver.1.2d」、「SS-MIX2拡張ストレージ構成の説明と構築ガイドラインVer.1.2d別紙：標準文書コード表」に記載している仕様に対応していること。（尚、当初Ver.1.2c準拠としていたが、標準ストレージ部分ではVer.1.2cからの変更点について影響がないためVer.1.2d準拠ということとした。）
* 標準化ストレージ、拡張ストレージ、トランザクションストレージ、インデックスデータベースの４つのファイルを生成すること。
* 標準化ストレージにはデータ種別として36種のデータを出力すること。


（表1-1　標準化ストレージ格納データ）

|No|データ種別|種別名称|HL7メッセージ型|
|---|---|---|---|
|1|ADT-00 |患者基本情報の更新|ADT^A08|
|2|ADT-00 |患者基本情報の削除 |ADT^A23|
|3|ADT-01 |担当医の変更|ADT^A54|
|4|ADT-01 |担当医の取消|ADT^A55|
|5|ADT-12 |外来診察の受付 |ADT^A04|
|6|ADT-21 |入院予定 |ADT^A14|
|7|ADT-21 |入院予定の取消|ADT^A27|
|8|ADT-22 |入院実施 |ADT^A01|
|9|ADT-22 |入院実施の取消|ADT^A11|
|10|ADT-31|外出泊実施|ADT^A21|
|11|ADT-31|外出泊実施の取消 |ADT^A52|
|12|ADT-32|外出泊帰院実施 |ADT^A22|
|13|ADT-32|外出泊帰院実施の取消 |ADT^A53|
|14|ADT-41|転科・転棟(転室・転床)予定 |ADT^A15|
|15|ADT-41|転科・転棟(転室・転床)予定の取消|ADT^A26|
|16|ADT-42|転科・転棟(転室・転床)実施|ADT^A02|
|17|ADT-42|転科・転棟(転室・転床)実施の取消|ADT^A12|
|18|ADT-51|退院予定|ADT^A16|
|19|ADT-51|退院予定の取消 |ADT^A25|
|20|ADT-52|退院実施|ADT^A03|
|21|ADT-52|退院実施の取消 |ADT^A13|
|22|ADT-61|アレルギー情報の登録／更新 |ADT^A60|
|23|PPR-01|病名（歴）情報の登録／更新|PPR^ZD1|
|24|OMD |食事オーダ |OMD^O03|
|25|OMP-01|処方オーダ |RDE^Ｏ11|
|26|OMP-11|処方実施通知 |RAS^O17|
|27|OMP-02|注射オーダ |RDE^Ｏ11|
|28|OMP-12|注射実施通知 |RAS^O17|
|29|OML-01|検体検査オーダ|OML^O33|
|30|OML-11|検体検査結果通知 |OUL^R22|
|31|OMG-01|放射線検査オーダ |OMG^O19|
|32|OMG-11|放射線検査の実施通知 |OMI^Z23|
|33|OMG-02|内視鏡検査オーダ |OMG^O19|
|34|OMG-12|内視鏡検査の実施通知 |OMI^Z23|
|35|OMG-03|生理検査オーダ |OMG^O19|
|36|OMG-13|生理検査結果通知 |ORU^R01|

　「SS-MIX2標準化ストレージ構成の説明と構築ガイドラインVer.1.2d　p11」
　
### 1.2 拡張ストレージへの出力機能
現在のSS-MIX2モジュールでオプションとして既に導入している拡張ストレージへの出力機能は、そのまま提供すること。また、1.3.0で規定する出力を行うこと。


## 1.3　NHO対応としての設定
### 1.3.0 拡張ストレージへの出力機能
各社のSS-MIX2モジュールの拡張ストレージへの出力機能を利用し、以下の情報を出力すること。その際、 日本医療情報学会発行の「SS-MIX2拡張ストレージ構成の説明と構築ガイドラインVer.1.2d」に記載している仕様に対応していること。また、トランザクションストレージ、インデックスデータベースも同時に生成すること。

No|データ種別|種別名称|HL7メッセージ型|
|---|---|---|---|
|1|L-OBSERVATIONS^OBSERVATIONS^99ZL01 |バイタル検査結果|HL7 V2.5 ORU^R30|
|2|^（ローカル名称）^^11506-3^経過記録^LN|診療録（外来/入院含む）|HL7 CDA R2|
|2.1|^（ローカル名称）^^34108-1^外来診療録^LN|診療録（外来）（入院・外来が別の場合）|HL7 CDA R2|
|2.2|^（ローカル名称）^^34112-3^入院診療録^LN|診療録（入院）（入院・外来が別の場合）|HL7 CDA R2|
|3|^（ローカル名称）^^18842-5^退院時サマリー^LN|退院時サマリー|HL7 CDA R2|
|4|^（ローカル名称）^^57133-1^紹介状^LN|診療情報提供書|HL7 CDA R2|
|5|L-JSPEED^災害時JSPEED記録^99ZL01^74465-6^災害時JSPEED記録^LN|災害時JSPEED記録|HL7 CDA R2|


### 1.3.1　バイタル検査結果通知の出力
（１）バイタル検査結果通知のデータを、別紙の形式で拡張ストレージに出力する。
尚、「診療日」に出力する日付はOBX-14 トランザクション日時（測定した日）とする。

（２）ファイル作成の単位は、データの格納構造として日付の下にあるため、最大でも一日分が１ファイルにまとまっている形とする。一日の中で測定のたびに作成するのでも良い。
一日１ファイルなら、特定キーは測定日を出力する。一日に複数回のデータを出力する場合は、特定キーに測定日の時間まで（YYYYMMDDHH）出力すること。

### 1.3.2　バイタルデータの項目及び形式等
（１）バイタルデータとして取得する項目は、「拡張期血圧、収縮期血圧、脈拍数、呼吸数、体温」の５項目とする。

（２）OBX-3検査項目に出力するコードはJLAC10コードとする。[バイタルデータ](https://github.com/nhoHQ/SSMIX2_support_documents/blob/master/doc/vital_sign_def.md)を参考に適切なJLAC10を選択すること。

（３）上記以外の項目をSS-MIX2に出力することは問題ないが、今回の対応では扱わない。但し、今後の検討で仕様として扱うことになる場合は、JLAC10コードを基準とした標準コードを必須とすることを想定している。この今後想定される検査項目は別表として提供する。

### 1.3.3　標準コード変換機能
SS-MIX2データの出力に際しては、コードのマッピング表などに従って、院内のローカルコードを厚労省が定める標準コードに変換する機能を有すること。またマッピング表については、容易にその内容を変更できるマスターメンテナンスプログラム等の機能を有すること。

JLAC10コード、JANISコード、HOTコードについては、機構病院がNCDA事業に参加する場合においては機構から提供する。

### 1.3.4　標準化ストレージにおける文字コードについて
メッセージの文字コードについては、「標準化ストレージガイドライン」で示されているとおり、1バイト系文字はISO IR-6（ASCII）、2バイト系文字はISO IR87 （JIS X 0208　第一水準、第二水準）とする。
ただし現実には上記以外の文字コードが電子カルテシステムに登録されている可能性があるため、以下のように対応することとする。
```
1 半角カナ文字　→　全角カナ文字に置き換えてSS-MIX2に出力する。
2 外字　→　■で置き換えてSS-MIX2に出力する。
3 環境依存文字については変換表を機構より提供するのでそれにより変換してSS-MIX2に出力する。
```

### 1.3.5　単位の文字表記の統一
SS-MIX2データの出力に際して、臨床検査データのOBXセグメントの6フィールド目の単位の文字表記を統一すること。

【単位の文字表記の統一ルール例】ASCIIコードで表記すること

```　　　　
　　・かける	→	.（ドット）
　　・乗	→	*（アスタリスク）
　　・μ	→	u（小文字ユー）
　　・語尾に名称	→	（）で
　　・℃	→	cel
　　・‰	→	permil
　　・個	→	pcs


【上記ルールの適用例】
　　　・ｍＬ　　　	  →　mL　（ASCIIコード）
　　　・X10＾2/μl　→　.10*2/uL　（かける、乗、μ）
　　　・/HPF　	  →　/(hpf)　（語尾に名称）
```
### 1.3.6 単位変換機能

SS-MIX2データの出力に際して臨床検査データの単位に関しては、JLAC10コードごとに、機構が定める単位に変換を行った上でSS-MIX2データを生成すること。
尚、JLAC10コード別の単位表は別途機構から提供する。単位表は「SS-MIX2標準化ストレージ仕様書Ver.1.2」にも別表として添付する。

【単位変換例】

|JLAC10コード|数値|単位|→|JLAC10コード|数値|単位|
|---|---|---|---|---|---|---|
|1A025000000127201|10.5|mg/l|　　→|1A025000000127201|1.05|mg/dL|

### 1.3.7　計測値等の表記方法について
#### （１）定性値・検出限界以下・検出限界以上の表記
* OBX（検体検査結果）セグメントの５フィールド目（検査値）に検査結果を記述する場合、現在そのデータ形式はOBX-2フィールドの説明にあるようにNM型、ST型、CWE型のうちいずれかの形式で記述することとなっている。
* 今回の仕様では、定性値・検出限界以下・検出限界以上のデータについては、SN型の表現方法を用いてSN型の”^”を” “（スペース）に置き換える。
* この件の説明は、「SS-MIX2標準化ストレージ仕様書Ver.1.2」　P104 表3-77 検査結果セグメント（OBX）定義　のOBX-2の項目説明にも記述する。

#### （２）複数の要素が一つの値で表現されている場合の表記
　複数の要素が組み合わされ一つの結果値として表記されている場合は、それぞれの要素に分離して表記すること。例えば定量値とクラス値が組み合わされた結果値については、定量値とクラス値に分離する。

　【定量値とクラス値の分離の例】

定量値とクラス値が組み合わされた例

|検査名称|院内コード|結果値|
|---|---|---|
|ﾑﾝﾌﾟｽVirus IgG|001591|2.3(±)|
　　　　　　　　　　　　　　　         ↓
定量値とクラス値を分離した例

|SS-MIX2標準コード|院内コード|結果値|備考|
|---|---|---|---|
|5F432143102302304|001591|2.3|
|5F432143102302311|001591|  +-|（半角スペース2つプラスマイナス）

### 1.3.8　トランザクションストレージのデータ保持期間
　トランザクションストレージのデータ保持期間は、現在の標準化ストレージ及び拡張ストレージを作っているデータの再現に必要な分だけ保持しておくこと。

### 1.3.9 ST型の長さ
* RXE-23(与薬速度)はST型で長さが6であるが、正負の記号と小数点を考慮し（例: +266.865）、本事業では8桁まで許容するものとする。
* CX型は先頭成分がST型で長さが15であるが、IN1-10(被保険者グループ雇用者ID)に長い名称の保険者が出力される場合などを考慮し、本事業ではCX型の先頭成分は30桁まで許容するものとする。
* XAD型は第8成分(その他地理表示)がST型で長さが50であるが、全角50文字(100バイト)と解釈しているシステムがあり半角文字で100文字登録出来るため、本事業ではXAD型の第8成分は100桁まで許容するものとする。
 
### 1.3.10 トランザクションストレージのファイル切り替え機能
 SS-MIX2の仕様上、トランザクョンストレージはカレントの日付が変わった時点、もしくは記録中のトランザクションデータファイルのファイルサイズが一定量を超えた時点で、新たなファイルを作成して記録先を切り替えるものとするとなっているが、同一日付内において一定時刻（例えば17:00）を経過した時点で記録先を切り替える機能を追加する。
